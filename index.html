
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ARC HUB V7.1 | Surgery Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #38bdf8; --bg: #020617; --card: #0f172a; --green: #10b981; --blue: #3b82f6; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; }
        .dashboard { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #334155; padding-bottom: 20px; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; border: 2px solid var(--primary); display: flex; flex-direction: column; min-height: 420px; }
        .input-group { background: #1e293b; padding: 12px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #334155; }
        input, select { background: transparent; border: none; color: white; font-size: 16px; width: 100%; outline: none; }
        .label { font-size: 10px; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .balance { font-size: 11px; color: var(--primary); text-align: right; font-weight: bold; font-family: monospace; }
        .main-btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; margin-top: auto; }
        #status { font-family: monospace; color: var(--primary); font-size: 12px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

    <header>
        <h1>ARC HUB V7.1</h1>
        <button id="connectBtn" class="main-btn" style="background:#f59e0b; width:auto; padding:10px 40px;">CONNECT WALLET</button>
        <div id="status">Waiting for connection...</div>
    </header>

    <div class="dashboard">
        <div class="card">
            <h3>üîÑ SWAP ENGINE</h3>
            <div class="input-group">
                <span class="label">Pay with</span>
                <select id="tokenFrom"><option value="0">USDC</option><option value="1">EURC</option></select>
                <input type="number" id="swapAmount" placeholder="0.0">
                <div class="balance" id="balFrom">Bal: 0.00</div>
            </div>
            <div class="input-group">
                <span class="label">Receive</span>
                <select id="tokenTo"><option value="1">EURC</option><option value="0">USDC</option></select>
                <input type="text" id="swapResult" readonly placeholder="0.0">
                <div class="balance" id="balTo">Bal: 0.00</div>
            </div>
            <button id="swapBtn" class="main-btn" style="background:var(--green);">SWAP</button>
        </div>

        <div class="card">
            <h3>üåâ BRIDGE ENGINE</h3>
            <div class="input-group">
                <span class="label">Amount to Bridge (USDC)</span>
                <input type="number" id="bridgeAmt" value="1.0">
                <div class="balance bal-native">Bal: 0.00 USDC</div>
            </div>
            <div class="input-group">
                <span class="label">Destination</span>
                <select id="bridgeNet">
                    <option value="6">Base Sepolia</option>
                    <option value="0">Ethereum Sepolia</option>
                </select>
            </div>
            <button onclick="runBridge()" class="main-btn" style="background:var(--blue);">BRIDGE (AUTO-MINT)</button>
        </div>

        <div class="card">
            <h3>üè¶ POOL VAULT</h3>
            <div class="input-group">
                <span class="label">Supply USDC to Vault</span>
                <input type="number" id="poolAmt" placeholder="1.0">
                <div class="balance bal-native">Bal: 0.00 USDC</div>
            </div>
            <p style="font-size: 10px; color: #94a3b8; margin-top: -5px;">Envia USDC nativo via deposit() seletor.</p>
            <button onclick="runPoolDeposit()" class="main-btn" style="background:#6366f1;">SUPPLY TO POOL</button>
        </div>
    </div>

<script>
    const POOL = "0x2d84d79c852f6842abe0304b70bbaa1506add457";
    const TOKENS = ["0x3600000000000000000000000000000000000000", "0x89b50855aa3be2f677cd6303cec089b5f319d72a"];
    const VAULT = "0x0000006a50a9c9efae8875266fb8538740f90e66";
    const FORWARDER = "0x397753697eb3474f5a675fa2ac2f67990666014c";
    const HUB_TAG = "617263687562";

    let provider, signer, walletAddress;
    const ABI = [
        "function approve(address s, uint256 a) public returns (bool)",
        "function exchange(int128 i, int128 j, uint256 dx, uint256 m) external returns (uint256)",
        "function get_dy(int128 i, int128 j, uint256 dx) external view returns (uint256)",
        "function balanceOf(address a) public view returns (uint256)"
    ];

    async function sync() {
        if (!signer) return;
        const bNative = await provider.getBalance(walletAddress);
        const eurc = new ethers.Contract(TOKENS[1], ABI, signer);
        const bEurc = await eurc.balanceOf(walletAddress);
        
        const fNative = parseFloat(ethers.utils.formatEther(bNative)).toFixed(2);
        const fEurc = parseFloat(ethers.utils.formatUnits(bEurc, 6)).toFixed(2);

        document.getElementById('balFrom').innerText = `Bal: ${fNative}`;
        document.getElementById('balTo').innerText = `Bal: ${fEurc}`;
        document.querySelectorAll('.bal-native').forEach(el => el.innerText = fNative + " USDC");
    }

    document.getElementById('connectBtn').onclick = async () => {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        const accts = await provider.send("eth_requestAccounts", []);
        walletAddress = accts[0]; signer = provider.getSigner();
        document.getElementById('connectBtn').style.display = "none";
        document.getElementById('status').innerText = "Connected: " + walletAddress;
        sync();
    };

    // --- MOTOR SWAP (V2.6.1 ORIGINAL) ---
    async function calculateSwap() {
        const amt = document.getElementById('swapAmount').value;
        if(!amt || amt <= 0) return;
        try {
            const pool = new ethers.Contract(POOL, ABI, provider);
            const dy = await pool.get_dy(0, 1, ethers.utils.parseUnits(amt, 6));
            document.getElementById('swapResult').value = ethers.utils.formatUnits(dy, 6);
        } catch(e) {}
    }
    document.getElementById('swapAmount').oninput = calculateSwap;

    document.getElementById('swapBtn').onclick = async () => {
        const amt = document.getElementById('swapAmount').value;
        const status = document.getElementById('status');
        try {
            const val = ethers.utils.parseUnits(amt, 6);
            const token = new ethers.Contract(TOKENS[0], ABI, signer);
            const pool = new ethers.Contract(POOL, ABI, signer);
            status.innerText = "Approving...";
            await (await token.approve(POOL, ethers.constants.MaxUint256)).wait();
            status.innerText = "Swapping...";
            const txData = await pool.populateTransaction.exchange(0, 1, val, 0);
            txData.data += HUB_TAG;
            const tx = await signer.sendTransaction(txData);
            await tx.wait(); status.innerText = "‚úÖ Swap Success!"; sync(); confetti();
        } catch(e) { status.innerText = "Swap Error"; }
    };

    // --- MOTOR BRIDGE (FORWARDER) ---
    async function runBridge() {
        const amt = document.getElementById('bridgeAmt').value;
        const net = document.getElementById('bridgeNet').value;
        const fwd = new ethers.Contract(FORWARDER, ["function depositForBurn(uint256,uint32,bytes32,address) external payable"], signer);
        try {
            const amt18 = ethers.utils.parseUnits(amt, 18);
            const rec = ethers.utils.hexZeroPad(walletAddress, 32);
            const tx = await fwd.depositForBurn(amt18, net, rec, TOKENS[0], { value: amt18, gasLimit: 400000 });
            await tx.wait(); sync(); confetti();
        } catch(e) { console.error(e); }
    }

    // --- MOTOR POOL (VAULT V6.2) ---
    async function runPoolDeposit() {
        const v = document.getElementById('poolAmt').value;
        try {
            const amt18 = ethers.utils.parseEther(v);
            const tx = await signer.sendTransaction({
                to: VAULT,
                value: amt18,
                data: "0xd0e30db0" + HUB_TAG,
                gasLimit: 300000
            });
            await tx.wait(); sync(); confetti();
        } catch(e) { console.error(e); }
    }
</script>
</body>
</html>
