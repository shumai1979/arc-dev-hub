<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARC Dev Hub | shumai1979</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 50px; background: #0f172a; color: white; }
        .card { background: #1e293b; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); display: inline-block; max-width: 450px; border: 1px solid #334155; }
        h1 { color: #38bdf8; font-size: 24px; }
        .score-badge { background: #059669; color: white; padding: 8px 16px; border-radius: 50px; font-weight: bold; display: inline-block; margin-bottom: 20px; }
        button { margin-top: 15px; padding: 16px 32px; font-size: 16px; cursor: pointer; border-radius: 12px; border: none; color: white; font-weight: bold; width: 100%; transition: 0.2s; }
        .btn-connect { background: #3b82f6; }
        .btn-interact { background: #8b5cf6; display: none; }
        #status { margin-top: 25px; font-weight: bold; font-size: 13px; color: #10b981; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ARC Interaction Hub</h1>
        <div class="score-badge">Gitcoin Passport: 31.9</div>
        <p>Dev: <strong>0x51D1...9024</strong></p>
        <button id="connectBtn" class="btn-connect">Conectar Carteira</button>
        <button id="interactBtn" class="btn-interact">Enviar Sinal (ARC Testnet)</button>
        <div id="status"></div>
    </div>

    <script>
        const connectBtn = document.getElementById('connectBtn');
        const interactBtn = document.getElementById('interactBtn');
        const statusDiv = document.getElementById('status');

        let userAccount = "";

        async function connect() {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0];
                    statusDiv.innerText = "Conectado: " + userAccount.substring(0,10) + "...";
                    connectBtn.style.display = 'none';
                    interactBtn.style.display = 'block';
                } catch (err) {
                    statusDiv.innerText = "Erro ao conectar.";
                }
            }
        }

        async function sendSignal() {
            // Parâmetros corrigidos para a Arc Testnet (ID: 5042002)
            const txParams = {
                from: userAccount,
                to: userAccount, // Envia para si próprio
                value: '0x0',
                gas: '0x5208', // 21000 gas
                chainId: '0x4ce942' // Hex de 5042002
            };
            
            try {
                statusDiv.style.color = "#fbbf24";
                statusDiv.innerText = "A abrir a Rabby... Confirme a transação.";
                
                // Força a mudança de rede antes da transação
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x4ce942' }],
                });

                const txHash = await window.ethereum.request({ 
                    method: 'eth_sendTransaction', 
                    params: [txParams] 
                });
                
                statusDiv.style.color = "#10b981";
                statusDiv.innerText = "Sinal enviado! Hash: " + txHash.substring(0,15) + "...";
            } catch (err) {
                console.error(err);
                statusDiv.style.color = "#f87171";
                statusDiv.innerText = "Erro: " + (err.message.includes("User denied") ? "Rejeitado na carteira" : "Verifique o gas (USDC)");
            }
        }

        connectBtn.onclick = connect;
        interactBtn.onclick = sendSignal;
    </script>
</body>
</html>
